<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MIRCARGOTRACK | Rastreo</title>
  <style>
    :root{
      --azulClaro:#38bdf8; --azulOscuro:#1e3a8a;
      --celesteTxt:#0284c7; --celesteBg:#e0f2fe;
      --gris:#f1f5f9; --gris2:#e2e8f0;
      --blanco:#ffffff; --texto:#0f172a;
      --amarilloP√°lido:#fde68a; --amarilloP√°lidoHover:#fcd34d;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--texto);background:var(--gris);}
    header{background:linear-gradient(90deg,var(--azulClaro),var(--azulOscuro));color:var(--blanco);padding:18px 12px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;box-shadow:0 2px 8px rgba(0,0,0,.25);}
    header h1{margin:0;font-size:24px;font-weight:900;text-transform:uppercase;letter-spacing:1px;font-style:italic;position:relative;display:inline-block;padding-right:40px;}
    header h1::after{content:'';position:absolute;bottom:-5px;left:0;width:100%;height:4px;background:linear-gradient(90deg,#38bdf8 0%,#1e3a8a 100%);transform-origin:left;animation:ray 2.8s linear infinite;clip-path:polygon(0 0,95% 0,100% 50%,95% 100%,0 100%);}
    @keyframes ray{0%{opacity:.4;transform:scaleX(0);}50%{opacity:1;transform:scaleX(1);}100%{opacity:.4;transform:scaleX(0);}}
    .flags{display:flex;gap:8px;}
    .flags img{width:30px;border-radius:4px;box-shadow:0 0 4px rgba(0,0,0,.25);}
    .btn-refresh{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.25);color:#fff;padding:8px 14px;font-weight:700;border-radius:10px;cursor:pointer;transition:all .25s ease;display:flex;align-items:center;gap:8px;backdrop-filter:blur(5px);}
    .btn-refresh:hover{background:rgba(255,255,255,0.25);transform:translateY(-1px);}
    .container{max-width:900px;margin:14px auto;padding:0 12px;display:flex;flex-direction:column;gap:14px;}
    .card{background:var(--blanco);border:1px solid var(--gris2);border-radius:12px;box-shadow:0 3px 12px rgba(2,6,23,.06);overflow:hidden;}
    .card-title{padding:10px 12px;font-weight:800;color:var(--texto);border-bottom:1px solid var(--gris2);background:#fafafa;font-size:16px;}
    .card-header{padding:10px 12px;border-bottom:1px solid var(--gris2);display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;}
    .input{display:flex;align-items:center;gap:8px;border:1px solid var(--gris2);border-radius:8px;padding:8px 10px;background:var(--blanco);}
    .input input{width:100%;border:none;outline:none;font-size:14px;}
    .btn{border:none;background:var(--amarilloP√°lido);color:#1f2937;padding:8px 12px;font-weight:700;border-radius:10px;cursor:pointer;}
    .btn:hover{background:var(--amarilloP√°lidoHover);}
    .table-wrap{overflow:auto;-webkit-overflow-scrolling:touch;}
    table{width:100%;border-collapse:collapse;min-width:620px;}
    th,td{padding:8px 10px;border-bottom:1px solid var(--gris2);text-align:left;font-size:13px;vertical-align:middle;}
    tbody tr:hover{background:#f9fafb;}
    .empty{padding:16px;text-align:center;color:#64748b;font-size:13px;line-height:1.4;}
    .meta{font-size:12px;color:#475569;margin-left:auto;}
    .view-btn{background:var(--celesteTxt);color:#fff;border:none;padding:7px 12px;border-radius:8px;cursor:pointer;font-size:12px;font-weight:800;box-shadow:0 1px 3px rgba(0,0,0,.15);transition:all .25s ease;}
    .view-btn:hover{background:#0369a1;transform:scale(1.05);}
    .status-pill{display:inline-block;padding:4px 10px;border-radius:9999px;background:var(--celesteBg);color:var(--celesteTxt);font-weight:800;line-height:1;box-shadow:0 1px 0 rgba(0,0,0,.06);}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <header>
  <div style="display:flex;align-items:center;gap:10px;">
    <!-- LOGO MIRCARGOTRACK -->
    <svg width="190" height="60" viewBox="0 0 520 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="MIRCARGOTRACK logo">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0" stop-color="#38bdf8"/>
          <stop offset="1" stop-color="#1e3a8a"/>
        </linearGradient>
      </defs>
      <g font-family="Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif">
        <text x="8" y="56" font-size="44" font-weight="900" fill="#0f172a" style="letter-spacing:1px; font-style:italic;">
          MIRCARGO<tspan fill="#1e3a8a">TRACK</tspan>
        </text>
        <path d="M8 70 L386 70 L402 86 L8 86 Z" fill="url(#g)" opacity="0.9">
          <animate attributeName="opacity" values="0.4;1;0.4" dur="2.5s" repeatCount="indefinite" />
        </path>
      </g>
      <g stroke="#0f172a" stroke-width="2.5" fill="none" opacity="0.9" transform="translate(408,24)">
        <path d="M0 30 h40 l8-10 h-56 l8 10z" />
        <path d="M-6 30 c10 10 20 10 30 0 c10 10 20 10 30 0" />
      </g>
      <g stroke="#1e3a8a" stroke-width="2.4" fill="none" transform="translate(418,8)">
        <path d="M0 18 l34 6 M34 6 l-8 8 l8 8" />
        <path d="M12 20 l-8 8" />
      </g>
    </svg>
  </div>
  </header>

  <main class="container">
    <!-- MAR√çTIMO (incluye entregas mar√≠timas) -->
    <section class="card" id="cardMaritimo">
      <div class="card-title">üö¢ Rastreo Mar√≠timo</div>
      <div class="card-header">
        <div class="input"><input id="searchMaritimo" placeholder="N√∫mero de rastreo (Mar√≠timo o Entrega Mar√≠timo)" /></div>
        <button class="btn" onclick="searchTracking('Maritimo')">Buscar</button>
        <div id="metaMaritimo" class="meta"></div>
      </div>
      <div class="table-wrap"><table><thead id="theadMaritimo"></thead><tbody id="tbodyMaritimo"></tbody></table></div>
      <div id="emptyMaritimo" class="empty" style="display:none;">‚ùå No encontramos ese n√∫mero de rastreo.</div>
    </section>

    <!-- A√âREO (incluye entregas a√©reas) -->
    <section class="card" id="cardAereo">
      <div class="card-title">‚úàÔ∏è Rastreo A√©reo</div>
      <div class="card-header">
        <div class="input"><input id="searchAereo" placeholder="N√∫mero de rastreo (A√©reo o Entrega A√©reo)" /></div>
        <button class="btn" onclick="searchTracking('Aereo')">Buscar</button>
        <div id="metaAereo" class="meta"></div>
      </div>
      <div class="table-wrap"><table><thead id="theadAereo"></thead><tbody id="tbodyAereo"></tbody></table></div>
      <div id="emptyAereo" class="empty" style="display:none;">‚ùå No encontramos ese n√∫mero de rastreo.</div>
    </section>

    <!-- COMPRA -->
    <section class="card" id="cardCompra">
      <div class="card-title">üõçÔ∏è Rastreo de compra en l√≠nea</div>
      <div class="card-header">
        <div class="input"><input id="searchCompra" placeholder="Nombre o n√∫mero de tracking" /></div>
        <button class="btn" onclick="searchTracking('Compra')">Buscar</button>
        <div id="metaCompra" class="meta"></div>
      </div>
      <div class="table-wrap"><table><thead id="theadCompra"></thead><tbody id="tbodyCompra"></tbody></table></div>
      <div id="emptyCompra" class="empty" style="display:none;">‚ö†Ô∏è Ese n√∫mero puede estar equivocado o a√∫n no se ha recibido.</div>
    </section>
  </main>

  <script>
    const urls={
      Maritimo:[
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=0&single=true&output=csv',
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=74043504&single=true&output=csv'
      ],
      Aereo:[
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=1764022928&single=true&output=csv',
        'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=624370760&single=true&output=csv'
      ],
      Compra:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=574168813&single=true&output=csv'
    };

    function normalizeImageUrl(url){
      if(!url)return'';
      url=url.trim();
      let m=url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
      if(m)return`https://drive.google.com/uc?export=view&id=${m[1]}`;
      m=url.match(/\/file\/d\/([a-zA-Z0-9_-]+)\//);
      if(m)return`https://drive.google.com/uc?export=view&id=${m[1]}`;
      return url;
    }

    function renderTable(data,prefix,headers){
      const thead=document.getElementById(`thead${prefix}`);
      const tbody=document.getElementById(`tbody${prefix}`);
      const empty=document.getElementById(`empty${prefix}`);
      const meta=document.getElementById(`meta${prefix}`);
      thead.innerHTML='';tbody.innerHTML='';
      if(!data.length){empty.style.display='block';meta.textContent='';return;}
      empty.style.display='none';
      const headersFiltrados=headers.filter(h=>!h.toLowerCase().includes('foto')||h.toLowerCase().includes('link_foto'));
      const trHead=document.createElement('tr');
      headersFiltrados.forEach(h=>{const th=document.createElement('th');th.textContent=h;trHead.appendChild(th);});
      thead.appendChild(trHead);
      data.forEach(row=>{
        const tr=document.createElement('tr');
        headersFiltrados.forEach(h=>{
          const val=row[h]??'';const td=document.createElement('td');
          if(h.toLowerCase().includes('link_foto')&&val){
            const imgUrl=normalizeImageUrl(val);
            td.innerHTML=`<button class="view-btn" onclick="window.open('${imgUrl}','_blank')">üì∑ Ver foto</button>`;
          }else td.textContent=val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      meta.textContent=`Mostrando ${data.length} coincidencia(s)`;
    }

    async function searchTracking(kind){
      const input=document.getElementById(`search${kind}`);
      const code=input.value.trim().toLowerCase();
      if(!code)return;

      let urlsToFetch = Array.isArray(urls[kind]) ? urls[kind] : [urls[kind]];
      let allData = [];

      for (const u of urlsToFetch) {
        await new Promise(resolve=>{
          Papa.parse(u+'&t='+Date.now(),{
            download:true,header:true,skipEmptyLines:true,
            complete:res=>{
              allData = allData.concat(res.data||[]);
              resolve();
            },error:()=>resolve()
          });
        });
      }

      const headers = Object.keys(allData[0]||{});
      const result = allData.filter(r=>{
        const vals=Object.values(r).map(v=>String(v).toLowerCase());
        return vals.some(v=>v.includes(code));
      });
      renderTable(result,kind,headers);
    }

    document.getElementById('reloadBtn').onclick=()=>location.reload();
    ['Maritimo','Aereo','Compra'].forEach(k=>{
      const el=document.getElementById(`search${k}`);
      el.addEventListener('keydown',e=>{if(e.key==='Enter')searchTracking(k);});
    });
  </script>
</body>
</html>
