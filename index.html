<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rastreo | MIR</title>
  <style>
    :root {
      --azulClaro: #38bdf8;
      --azulOscuro: #1e3a8a;
      --gris: #f1f5f9;
      --gris2: #e2e8f0;
      --amarillo: #fbbf24;
      --blanco: #ffffff;
      --texto: #0f172a;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--texto);
      background: var(--gris);
    }

    header {
      background: linear-gradient(90deg, var(--azulClaro), var(--azulOscuro));
      color: var(--blanco);
      padding: 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      box-shadow: 0 2px 8px rgba(0,0,0,.25);
    }

    header h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 800;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .icons svg {
      width: 38px;
      height: 38px;
      fill: #fff;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.4));
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .flags img {
      width: 35px;
      border-radius: 4px;
      box-shadow: 0 0 4px rgba(0,0,0,.25);
    }

    .btn-refresh {
      background: var(--amarillo);
      color: #111827;
      padding: 10px 14px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: .2s;
    }

    .btn-refresh:hover { background: #facc15; }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 0 16px;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    .card {
      background: var(--blanco);
      border: 1px solid var(--gris2);
      border-radius: 14px;
      box-shadow: 0 4px 16px rgba(2,6,23,.06);
      overflow: hidden;
    }

    .card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 14px 16px;
      font-weight: 800;
      color: var(--texto);
      border-bottom: 1px solid var(--gris2);
      background: #fafafa;
    }

    .card-header {
      padding: 16px;
      border-bottom: 1px solid var(--gris2);
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .input {
      flex: 1 1 260px;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid var(--gris2);
      border-radius: 10px;
      padding: 10px 12px;
      background: var(--blanco);
    }

    .input input {
      width: 100%;
      border: none;
      outline: none;
      font-size: 14px;
    }

    .btn {
      border: none;
      background: var(--amarillo);
      color: #111827;
      padding: 10px 14px;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: .2s;
    }

    .btn:hover { background: #facc15; }

    table { width: 100%; border-collapse: collapse; }
    th, td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--gris2);
      text-align: left;
      font-size: 14px;
      vertical-align: middle;
    }

    tbody tr:hover { background: #f9fafb; }
    .empty { padding: 28px; text-align: center; color: #64748b; }
    .meta { font-size: 12px; color: #475569; margin-left: auto; }
    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 9999px;
      background: var(--amarillo);
      color: #111827;
      font-weight: 800;
      font-size: 12px;
    }

    /* Miniaturas con vista previa */
    .thumb-container {
      position: relative;
      display: inline-block;
    }

    img.thumb {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    img.thumb:hover { transform: scale(1.05); }

    .preview {
      display: none;
      position: absolute;
      top: -5px;
      left: 80px;
      z-index: 100;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .thumb-container:hover .preview {
      display: block;
    }

    .view-btn {
      background: var(--amarillo);
      border: none;
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #111827;
      margin-top: 5px;
    }

    .view-btn:hover { background: #fde047; }

    /* Modal grande */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-content {
      max-width: 95%;
      max-height: 90%;
      border-radius: 12px;
    }

    .close {
      position: absolute;
      top: 20px;
      right: 30px;
      color: white;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <header>
    <h1>RASTREO MAURA MULTISERVICES üö¢‚úàÔ∏è</h1>
    <div class="header-right">
      <div class="flags">
        <img src="https://flagcdn.com/us.svg">
        <img src="https://flagcdn.com/ni.svg">
      </div>
      <button id="reloadBtn" class="btn-refresh">üîÑ Actualizar</button>
    </div>
  </header>

  <main class="container">
    <section class="card" id="cardMaritimo">
      <div class="card-title">üö¢ Rastreo Mar√≠timo</div>
      <div class="card-header">
        <div class="input"><input id="searchMaritimo" placeholder="N√∫mero de rastreo (Mar√≠timo)" /></div>
        <button class="btn" onclick="searchTracking('Maritimo')">Buscar</button>
        <div id="metaMaritimo" class="meta"></div>
      </div>
      <table><thead id="theadMaritimo"></thead><tbody id="tbodyMaritimo"></tbody></table>
      <div id="emptyMaritimo" class="empty" style="display:none;">No se encontr√≥ informaci√≥n.</div>
    </section>

    <section class="card" id="cardAereo">
      <div class="card-title">‚úàÔ∏è Rastreo A√©reo</div>
      <div class="card-header">
        <div class="input"><input id="searchAereo" placeholder="N√∫mero de rastreo (A√©reo)" /></div>
        <button class="btn" onclick="searchTracking('Aereo')">Buscar</button>
        <div id="metaAereo" class="meta"></div>
      </div>
      <table><thead id="theadAereo"></thead><tbody id="tbodyAereo"></tbody></table>
      <div id="emptyAereo" class="empty" style="display:none;">No se encontr√≥ informaci√≥n.</div>
    </section>

    <section class="card" id="cardCompra">
      <div class="card-title">üõçÔ∏è Rastreo de compra en l√≠nea</div>
      <div class="card-header">
        <div class="input"><input id="searchCompra" placeholder="Nombre o n√∫mero de tracking" /></div>
        <button class="btn" onclick="searchTracking('Compra')">Buscar</button>
        <div id="metaCompra" class="meta"></div>
      </div>
      <table><thead id="theadCompra"></thead><tbody id="tbodyCompra"></tbody></table>
      <div id="emptyCompra" class="empty" style="display:none;">No se encontr√≥ informaci√≥n.</div>
    </section>
  </main>

  <div id="imgModal" class="modal" onclick="closeModal()">
    <span class="close">&times;</span>
    <img id="modalImg" class="modal-content" alt="Vista ampliada">
  </div>

  <script>
    const urls = {
      Maritimo: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=0&single=true&output=csv',
      Aereo: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=1764022928&single=true&output=csv',
      Compra: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=574168813&single=true&output=csv'
    };

    function normalizeImageUrl(url) {
      if (!url) return '';
      url = url.trim();
      const match = url.match(/id=([a-zA-Z0-9_-]+)/);
      if (match) return `https://drive.google.com/uc?export=view&id=${match[1]}`;
      return url;
    }

    function renderTable(data,prefix,headers){
      const thead=document.getElementById(`thead${prefix}`);
      const tbody=document.getElementById(`tbody${prefix}`);
      const empty=document.getElementById(`empty${prefix}`);
      const meta=document.getElementById(`meta${prefix}`);
      thead.innerHTML=''; tbody.innerHTML='';
      if(!data.length){ empty.style.display='block'; meta.textContent=''; return; }
      empty.style.display='none';

      const trHead=document.createElement('tr');
      headers.forEach(h=>{ const th=document.createElement('th'); th.textContent=h; trHead.appendChild(th); });
      thead.appendChild(trHead);

      data.forEach(row=>{
        const tr=document.createElement('tr');
        headers.forEach(h=>{
          const val=row[h]??'';
          const td=document.createElement('td');
          if(h.toLowerCase().includes('foto') && val){
            const imgUrl=normalizeImageUrl(val);
            td.innerHTML = `
              <div class="thumb-container">
                <img src="${imgUrl}" class="thumb" onclick="openModal('${imgUrl}')">
                <img src="${imgUrl}" class="preview" width="250">
              </div>
              <br>
              <button class="view-btn" onclick="window.open('${imgUrl}','_blank')">üì∑ Ver foto</button>`;
          } else {
            td.textContent = val;
          }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      meta.textContent=`Mostrando ${data.length} coincidencia(s)`;
    }

    function searchTracking(kind){
      const input=document.getElementById(`search${kind}`);
      const code=input.value.trim().toLowerCase();
      if(!code) return;
      Papa.parse(urls[kind],{
        download:true, header:true, skipEmptyLines:true,
        complete:res=>{
          const rows=res.data||[];
          const headers=res.meta.fields||Object.keys(rows[0]||{});
          const result=rows.filter(r=>{
            const cols=Object.values(r).map(c=>String(c).toLowerCase());
            return cols.some(c=>c.includes(code));
          });
          renderTable(result,kind,headers);
        }
      });
    }

    function openModal(src){
      document.getElementById('modalImg').src=src;
      document.getElementById('imgModal').style.display='flex';
    }

    function closeModal(){
      document.getElementById('imgModal').style.display='none';
    }

    document.getElementById('reloadBtn').onclick = () => location.reload();
  </script>
</body>
</html>
