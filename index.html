<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MIRCARGOTRACK | Rastreo</title>
  <style>
    :root{
      --azulClaro:#38bdf8; --azulOscuro:#1e3a8a;
      --celesteTxt:#0284c7; --celesteBg:#e0f2fe;
      --gris:#f1f5f9; --gris2:#e2e8f0;
      --blanco:#ffffff; --texto:#0f172a;
      --amarilloP√°lido:#fde68a; --amarilloP√°lidoHover:#fcd34d;
    }

    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--texto);background:var(--gris);}
    header{
      background:linear-gradient(90deg,var(--azulClaro),var(--azulOscuro));
      color:var(--blanco);
      padding:18px 12px;
      display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;
      box-shadow:0 2px 8px rgba(0,0,0,.25);
    }
    header h1{
      margin:0;font-size:24px;font-weight:900;text-transform:uppercase;
      letter-spacing:1px;font-style:italic;position:relative;display:inline-block;padding-right:40px;
    }
    header h1::after{
      content:'';position:absolute;bottom:-5px;left:0;width:100%;height:4px;
      background:linear-gradient(90deg,#38bdf8 0%,#1e3a8a 100%);
      transform-origin:left;animation:ray 2.8s linear infinite;
      clip-path:polygon(0 0,95% 0,100% 50%,95% 100%,0 100%);
    }
    @keyframes ray{0%{opacity:0.4;transform:scaleX(0);}50%{opacity:1;transform:scaleX(1);}100%{opacity:0.4;transform:scaleX(0);}}
    .btn-refresh{background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.25);color:#fff;padding:8px 14px;font-weight:700;border-radius:10px;cursor:pointer;transition:all .25s ease;display:flex;align-items:center;gap:8px;}
    .btn-refresh:hover{background:rgba(255,255,255,0.25);transform:translateY(-1px);}
    .btn-refresh span.icon{font-size:18px;transition:transform .3s;}
    .btn-refresh:hover span.icon{transform:rotate(180deg);}
    .container{max-width:900px;margin:14px auto;padding:0 12px;display:flex;flex-direction:column;gap:14px;}
    .card{background:var(--blanco);border:1px solid var(--gris2);border-radius:12px;box-shadow:0 3px 12px rgba(2,6,23,.06);overflow:hidden;}
    .card-title{padding:10px 12px;font-weight:800;color:var(--texto);border-bottom:1px solid var(--gris2);background:#fafafa;font-size:16px;}
    .input{display:flex;align-items:center;gap:8px;border:1px solid var(--gris2);border-radius:8px;padding:8px 10px;background:var(--blanco);}
    .input input{width:100%;border:none;outline:none;font-size:14px;}
    .btn{border:none;background:var(--amarilloP√°lido);color:#1f2937;padding:8px 12px;font-weight:700;border-radius:10px;cursor:pointer;}
    .btn:hover{background:var(--amarilloP√°lidoHover);}
    .view-btn{background:var(--celesteTxt);color:#fff;border:none;padding:7px 12px;border-radius:8px;cursor:pointer;font-size:12px;font-weight:800;box-shadow:0 1px 3px rgba(0,0,0,.15);transition:all .25s ease;}
    .view-btn:hover{background:#0369a1;transform:scale(1.05);}
    .status-pill{display:inline-block;padding:4px 10px;border-radius:9999px;background:var(--celesteBg);color:var(--celesteTxt);font-weight:800;line-height:1;}
    .meta{font-size:12px;color:#475569;margin-left:auto;}
    @media (max-width:640px){
      header{padding:12px 10px;}
      header h1{font-size:18px;}
      .container{gap:12px;padding:0 10px;}
      .card-title{font-size:15px;padding:8px 10px;}
      .btn{padding:7px 10px;font-size:12px;border-radius:8px;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <header>
    <h1>MIRCARGOTRACK</h1>
    <button id="reloadBtn" class="btn-refresh"><span class="icon">üîÑ</span><span class="text">Actualizar</span></button>
  </header>

  <main class="container">

    <!-- Mar√≠timo -->
    <section class="card">
      <div class="card-title">üö¢ Rastreo Mar√≠timo</div>
      <div class="input"><input id="searchMaritimo" placeholder="N√∫mero de rastreo (Mar√≠timo)" /></div>
      <button class="btn" onclick="searchTracking('Maritimo')">Buscar</button>
      <div class="meta" id="metaMaritimo"></div>
      <table><thead id="theadMaritimo"></thead><tbody id="tbodyMaritimo"></tbody></table>
    </section>

    <!-- A√©reo -->
    <section class="card">
      <div class="card-title">‚úàÔ∏è Rastreo A√©reo</div>
      <div class="input"><input id="searchAereo" placeholder="N√∫mero de rastreo (A√©reo)" /></div>
      <button class="btn" onclick="searchTracking('Aereo')">Buscar</button>
      <div class="meta" id="metaAereo"></div>
      <table><thead id="theadAereo"></thead><tbody id="tbodyAereo"></tbody></table>
    </section>

    <!-- Amazon -->
    <section class="card">
      <div class="card-title">üì¶ Rastreo de compras en l√≠nea</div>
      <div class="input"><input id="searchCompra" placeholder="Nombre o n√∫mero de tracking" /></div>
      <button class="btn" onclick="searchTracking('Compra')">Buscar</button>
      <div class="meta" id="metaCompra"></div>
      <table><thead id="theadCompra"></thead><tbody id="tbodyCompra"></tbody></table>
    </section>

    <!-- NUEVO: Entregas A√©reas -->
    <section class="card">
      <div class="card-title">‚úàÔ∏è Rastreo de Entregas A√©reas</div>
      <div class="input"><input id="searchAereoEntrega" placeholder="N√∫mero de rastreo (Entrega A√©rea)" /></div>
      <button class="btn" onclick="searchTracking('AereoEntrega')">Buscar</button>
      <div class="meta" id="metaAereoEntrega"></div>
      <table><thead id="theadAereoEntrega"></thead><tbody id="tbodyAereoEntrega"></tbody></table>
    </section>

    <!-- NUEVO: Entregas Mar√≠timas -->
    <section class="card">
      <div class="card-title">üö¢ Rastreo de Entregas Mar√≠timas</div>
      <div class="input"><input id="searchEntregaMaritimo" placeholder="N√∫mero de rastreo (Entrega Mar√≠tima)" /></div>
      <button class="btn" onclick="searchTracking('EntregaMaritimo')">Buscar</button>
      <div class="meta" id="metaEntregaMaritimo"></div>
      <table><thead id="theadEntregaMaritimo"></thead><tbody id="tbodyEntregaMaritimo"></tbody></table>
    </section>

  </main>

  <script>
    const urls = {
      Maritimo:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=0&single=true&output=csv',
      Aereo:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=1764022928&single=true&output=csv',
      Compra:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=574168813&single=true&output=csv',
      AereoEntrega:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=624370760&single=true&output=csv',
      EntregaMaritimo:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=74043504&single=true&output=csv'
    };

    function normalizeImageUrl(url){
      if(!url)return'';
      url=url.trim();
      let m=url.match(/[?&]id=([a-zA-Z0-9_-]+)/);
      if(m)return`https://drive.google.com/uc?export=view&id=${m[1]}`;
      m=url.match(/\/file\/d\/([a-zA-Z0-9_-]+)\//);
      if(m)return`https://drive.google.com/uc?export=view&id=${m[1]}`;
      return url;
    }

    function renderTable(data,prefix,headers){
      const tbody=document.getElementById(`tbody${prefix}`);
      const meta=document.getElementById(`meta${prefix}`);
      tbody.innerHTML='';
      if(!data.length){meta.textContent='‚ùå No se encontr√≥ el rastreo.';return;}
      meta.textContent=`Mostrando ${data.length} resultado(s)`;

      data.forEach(row=>{
        const tr=document.createElement('tr');
        headers.forEach(h=>{
          const val=row[h]??'';const td=document.createElement('td');
          if(h.toLowerCase().includes('link_foto')&&val){
            const imgUrl=normalizeImageUrl(val);
            td.innerHTML=`<button class="view-btn" onclick="window.open('${imgUrl}','_blank')">üì∑ Ver foto</button>`;
          }else if(h.toLowerCase().includes('status')){
            td.innerHTML=`<span class="status-pill">${val}</span>`;
          }else td.textContent=val;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function searchTracking(kind){
      const input=document.getElementById(`search${kind}`);
      const code=input.value.trim().toLowerCase();
      if(!code)return;
      Papa.parse(urls[kind],{
        download:true,header:true,skipEmptyLines:true,
        complete:res=>{
          const rows=res.data||[];
          const headers=res.meta.fields||Object.keys(rows[0]||{});
          const result=rows.filter(r=>{
            const vals=Object.values(r).map(v=>String(v).toLowerCase());
            return vals.some(v=>v.includes(code));
          });
          renderTable(result,kind,headers);
        }
      });
    }

    document.getElementById('reloadBtn').onclick=()=>location.reload();
    ['Maritimo','Aereo','Compra','AereoEntrega','EntregaMaritimo'].forEach(k=>{
      const el=document.getElementById(`search${k}`);
      el.addEventListener('keydown',e=>{if(e.key==='Enter')searchTracking(k);});
    });
  </script>
</body>
</html>
