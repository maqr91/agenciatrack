<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rastreo | MIR</title>
  <style>
    :root{ --azul:#1e3a8a; --gris:#f1f5f9; --gris2:#e2e8f0; --texto:#0f172a; --amarillo:#fbbf24; --blanco:#ffffff; }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--texto); background:var(--gris); }
    header{ background:var(--azul); color:var(--blanco); padding:18px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    header h1{ margin:0; font-size:22px; font-weight:800; text-transform:uppercase; display:flex; align-items:center; gap:10px; }
    .icons{ display:flex; gap:10px; align-items:center; }
    .icons svg{ width:30px; height:30px; fill:#ffffff; opacity:.9; }
    .header-right{ display:flex; align-items:center; gap:15px; }
    .flags img{ width:35px; border-radius:4px; box-shadow:0 0 4px rgba(0,0,0,.25); }
    .btn-refresh{ background:var(--amarillo); color:#111827; padding:10px 14px; font-weight:600; border:none; border-radius:10px; cursor:pointer; }
    .btn-refresh:hover{ background:#facc15; }

    .container{ max-width:900px; margin:20px auto; padding:0 16px; display:flex; flex-direction:column; gap:22px; }
    .card{ background:var(--blanco); border:1px solid var(--gris2); border-radius:14px; box-shadow:0 4px 16px rgba(2,6,23,.06); overflow:hidden; }
    .card-title{ display:flex; align-items:center; gap:10px; padding:14px 16px; font-weight:800; color:#0f172a; border-bottom:1px solid var(--gris2); background:#fafafa; }
    .card-title svg{ width:22px; height:22px; fill:#0f172a; opacity:.85; }
    .card-header{ padding:16px; border-bottom:1px solid var(--gris2); display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .input{ flex:1 1 260px; display:flex; align-items:center; gap:8px; border:1px solid var(--gris2); border-radius:10px; padding:10px 12px; background:var(--blanco); }
    .input input{ width:100%; border:none; outline:none; font-size:14px; }
    .btn{ appearance:none; border:none; background:var(--amarillo); color:#111827; padding:10px 14px; font-weight:600; border-radius:10px; cursor:pointer; }
    .btn:hover{ background:#facc15; }

    table{ width:100%; border-collapse:collapse; }
    thead{ background:#f8fafc; position:sticky; top:0; z-index:1; }
    th,td{ padding:10px 12px; border-bottom:1px solid var(--gris2); text-align:left; font-size:14px; }
    tbody tr:hover{ background:#f9fafb; }
    .table-wrap{ overflow:auto; max-height:70vh; }
    .empty{ padding:28px; text-align:center; color:#64748b; }
    .meta{ font-size:12px; color:#475569; margin-left:auto; }
    .pill{ display:inline-block; padding:4px 10px; border-radius:9999px; background:var(--amarillo); color:#111827; font-weight:800; font-size:12px; line-height:1; box-shadow:0 1px 0 rgba(0,0,0,.06); }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <header>
    <h1>
      Rastreo Maura Multiservices
      <span class="icons">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2.5 19l7.5-7-7.5-7 1.5-1.5 10 8.5v5l-10 8.5L2.5 19z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2l9 4-9 4-9-4 9-4zm9 6v10l-9 4-9-4V8l9 4 9-4z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M528 448H48c-26.5 0-48-21.5-48-48v-64l96-32 96 32 96-32 96 32 96-32v64c0 26.5-21.5 48-48 48zM144 128c-17.7 0-32 14.3-32 32v16h416v-16c0-17.7 14.3-32-32-32H144z"/></svg>
      </span>
    </h1>
    <div class="header-right">
      <div class="flags">
        <img src="https://flagcdn.com/us.svg" alt="EEUU">
        <img src="https://flagcdn.com/ni.svg" alt="Nicaragua">
      </div>
      <button id="reloadBtn" class="btn-refresh">üîÑ Actualizar</button>
    </div>
  </header>

  <main class="container">
    <!-- MAR√çTIMO -->
    <section class="card" id="cardMaritimo">
      <div class="card-title">
        üö¢ Rastreo Mar√≠timo
      </div>
      <div class="card-header">
        <div class="input"><input id="searchMaritimo" placeholder="N√∫mero de rastreo (Mar√≠timo)" /></div>
        <button class="btn" onclick="searchTracking('Maritimo')">Buscar</button>
        <div id="metaMaritimo" class="meta"></div>
      </div>
      <div class="table-wrap">
        <table>
          <thead id="theadMaritimo"></thead>
          <tbody id="tbodyMaritimo"></tbody>
        </table>
        <div id="emptyMaritimo" class="empty" style="display:none;">No se encontr√≥ informaci√≥n.</div>
      </div>
    </section>

    <!-- A√âREO -->
    <section class="card" id="cardAereo">
      <div class="card-title">
        ‚úàÔ∏è Rastreo A√©reo
      </div>
      <div class="card-header">
        <div class="input"><input id="searchAereo" placeholder="N√∫mero de rastreo (A√©reo)" /></div>
        <button class="btn" onclick="searchTracking('Aereo')">Buscar</button>
        <div id="metaAereo" class="meta"></div>
      </div>
      <div class="table-wrap">
        <table>
          <thead id="theadAereo"></thead>
          <tbody id="tbodyAereo"></tbody>
        </table>
        <div id="emptyAereo" class="empty" style="display:none;">No se encontr√≥ informaci√≥n.</div>
      </div>
    </section>
  </main>

  <script>
    const urls = {
      Maritimo: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=0&single=true&output=csv',
      Aereo: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgbPK4Q40kRpDEZ8oRYQbyqRFZW0gmvPz3z9RcEkJe3HRsGHuraEYsFIKkFwXDYGlzGovo9xDMFbnf/pub?gid=1764022928&single=true&output=csv'
    };

    const escapeHtml = (str)=>String(str).replace(/[&<>"']/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));

    function renderTable(data, prefix, headers, statusHeader){
      const thead = document.getElementById(`thead${prefix}`);
      const tbody = document.getElementById(`tbody${prefix}`);
      const empty = document.getElementById(`empty${prefix}`);
      const meta = document.getElementById(`meta${prefix}`);
      thead.innerHTML=''; tbody.innerHTML='';

      if (!data.length){ empty.style.display='block'; meta.textContent=''; return; }
      empty.style.display='none';

      const trHead=document.createElement('tr');
      headers.forEach(h=>{ const th=document.createElement('th'); th.textContent=h; trHead.appendChild(th); });
      thead.appendChild(trHead);

      data.forEach(row=>{
        const tr=document.createElement('tr');
        headers.forEach((h,i)=>{
          const td=document.createElement('td');
          const val=row[h] ?? '';
          if (i===1){ td.innerHTML=`<strong>${escapeHtml(val)}</strong>`; } // columna 2 en negritas
          else if (h===statusHeader){ td.innerHTML=`<span class="pill">${escapeHtml(val)}</span>`; }
          else{ td.innerHTML=escapeHtml(val); }
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      meta.textContent=`Mostrando ${data.length} coincidencia(s)`;
    }

    function searchTracking(kind){
      const input=document.getElementById(`search${kind}`);
      const code=input.value.trim().toLowerCase();
      if(!code) return;

      const url=urls[kind]+'&t='+Date.now();

      Papa.parse(url,{
        download:true, header:true, skipEmptyLines:true,
        complete:(res)=>{
          const rows=res.data||[];
          const headers=res.meta.fields||Object.keys(rows[0]||{});
          if(!headers.length){ renderTable([],kind,[],null); return; }

          const statusHeader=headers.find(h=>/^(status|estatus|estado)$/i.test(h))||null;

          // Buscar coincidencias solo en columna B (√≠ndice 1)
          const result = rows.filter(r => {
            const cols = Object.values(r);
            return String(cols[1] ?? '').toLowerCase() === code;
          });

          renderTable(result, kind, headers, statusHeader);
        },
        error:()=>{ renderTable([],kind,[],null); }
      });
    }

    document.getElementById('reloadBtn').addEventListener('click', ()=>{
      const m=document.getElementById('searchMaritimo').value.trim();
      const a=document.getElementById('searchAereo').value.trim();
      if(m) searchTracking('Maritimo');
      if(a) searchTracking('Aereo');
      if(!m && !a) location.reload();
    });

    // ENTER para buscar directamente
    ['Maritimo','Aereo'].forEach(kind=>{
      document.getElementById(`search${kind}`).addEventListener('keydown',(e)=>{
        if(e.key==='Enter') searchTracking(kind);
      });
    });
  </script>
</body>
</html>
